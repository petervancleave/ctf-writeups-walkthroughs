# Basic Malware RE
Difficulty: Medium




https://tryhackme.com/room/basicmalwarere


---
This challenge is about static analysis of malware. 
I will be using Ghidra to decompile the malware samples.

*(Note: The Password for the ZIP files is 'MalwareTech')*

Import all of the strings executables into Ghidra

SS1

### Strings :: Challenge 1

The first thing to do is check for an entry function. 

SS2

The C code shows defined lptext
lptext is set to md5 hash of the pointer.

SS3

Navigating to the pointer shows a ton of other pointers being defined too, so running strings on it would not reveal an obvious flag.

SS4

However, double clicking the defined string takes you to where it is defined in the code. This is the first flag.

SS5


### Strings :: Challenge 2

Next, open the strings2 executable.

Find the entry function again.

SS6

This time the C code shows the flag instantly...

I don't think this is how the challenge is supposed to be solved. Looking at the official writeup for the challenge shows there are supposed to be a ton of undefined variables. It is supposed to be a stack string. 

I can see the assembly as it was intended so lets look at that.

SS7

There is 40 bytes of data being allocated to the stack (hover over 0x28)

All of the following chars are being pushed onto the stack

The program is taking all of the characters from the stack, putting it together as a string, and then passes it through md5 hash.

The intended way to solve this challenge is to just decode all of the bytes and put them into a string.

### Strings :: Challenge 3

Open strings 3 exe, look at the entry function.

SS8

I see that local_a0 is the hash variable (like the previous two challenges).

Knowing this, its possible to work backwards and see what the local_a0 is doing.

`MD5::MD5(local_9c);` appears to be the hashing function

which means

`local_a0 = MD5::digestString(local_9c,&local_4a4);`

contains the flag string.

`LoadStringA((HINSTANCE)0x0,0x110,&local_4a4,0x3ff);`

loads a string in memory. I will convert the hexadecimal into decimal to see it better.

`LoadStringA((HINSTANCE)0x0,272,&local_4a4,1023)`

the current instance is 0, the id of what is loading is 272 and what its loading into is 1023 (the flag).

`local_c = FindResourceA((HMODULE)0x0,"rc.rc",(LPCSTR)0x6)`

rc file is a resource file for an executable.

we can see the content of the rc from the program trees

SS9

Scrolling down we see a bunch of flags

SS10

If we scroll down to the flag with ID 272 we get the flag.

(we know we are loading a string in the current instance at the ID 272).

SS11